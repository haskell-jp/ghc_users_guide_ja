
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>7.8. Filenames and separate compilation &mdash; Glasgow Haskell Compiler 8.2.2 User&#39;s Guide</title>
    
    <link rel="stylesheet" href="_static/ghc-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '8.2.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Glasgow Haskell Compiler 8.2.2 User&#39;s Guide"
          href="_static/opensearch.xml"/>
    <link rel="top" title="Glasgow Haskell Compiler 8.2.2 User&#39;s Guide" href="index.html" />
    <link rel="up" title="7. Using GHC" href="usage.html" />
    <link rel="next" title="7.9. Packages" href="packages.html" />
    <link rel="prev" title="7.7. Running a compiled program" href="runtime_control.html" /> 
  </head>
  <body>
<div class="logo">
    <h1><a href="index.html">Glasgow Haskell Compiler User's Guide</a></h1>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="packages.html" title="7.9. Packages"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="runtime_control.html" title="7.7. Running a compiled program"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">GHC 8.2.2 User&#39;s Guide</a> &raquo;</li>
          <li><a href="usage.html" accesskey="U">7. Using GHC</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="separate_compilation.html#">7.8. Filenames and separate compilation</a><ul>
<li><a class="reference internal" href="separate_compilation.html#haskell-source-files">7.8.1. Haskell source files</a></li>
<li><a class="reference internal" href="separate_compilation.html#output-files">7.8.2. Output files</a></li>
<li><a class="reference internal" href="separate_compilation.html#the-search-path">7.8.3. The search path</a></li>
<li><a class="reference internal" href="separate_compilation.html#redirecting-the-compilation-output-s">7.8.4. Redirecting the compilation output(s)</a></li>
<li><a class="reference internal" href="separate_compilation.html#keeping-intermediate-files">7.8.5. Keeping Intermediate Files</a></li>
<li><a class="reference internal" href="separate_compilation.html#redirecting-temporary-files">7.8.6. Redirecting temporary files</a></li>
<li><a class="reference internal" href="separate_compilation.html#other-options-related-to-interface-files">7.8.7. Other options related to interface files</a></li>
<li><a class="reference internal" href="separate_compilation.html#the-recompilation-checker">7.8.8. The recompilation checker</a></li>
<li><a class="reference internal" href="separate_compilation.html#how-to-compile-mutually-recursive-modules">7.8.9. How to compile mutually recursive modules</a></li>
<li><a class="reference internal" href="separate_compilation.html#module-signatures">7.8.10. Module signatures</a></li>
<li><a class="reference internal" href="separate_compilation.html#using-make">7.8.11. Using <tt class="docutils literal"><span class="pre">make</span></tt></a></li>
<li><a class="reference internal" href="separate_compilation.html#dependency-generation">7.8.12. Dependency generation</a></li>
<li><a class="reference internal" href="separate_compilation.html#orphan-modules-and-instance-declarations">7.8.13. Orphan modules and instance declarations</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="runtime_control.html"
                        title="previous chapter">7.7. Running a compiled program</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="packages.html"
                        title="next chapter">7.9. Packages</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/separate_compilation.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="filenames-and-separate-compilation">
<span id="separate-compilation"></span><h1>7.8. Filenames and separate compilation<a class="headerlink" href="separate_compilation.html#filenames-and-separate-compilation" title="Permalink to this headline">¶</a></h1>
<p id="index-0">This section describes what files GHC expects to find, what files it
creates, where these files are stored, and what options affect this
behaviour.</p>
<p>Pathname conventions vary from system to system. In particular, the
directory separator is &#8220;<tt class="docutils literal"><span class="pre">/</span></tt>&#8221; on Unix systems and &#8220;<tt class="docutils literal"><span class="pre">\</span></tt>&#8221; on
Windows systems. In the sections that follow, we shall consistently use
&#8220;<tt class="docutils literal"><span class="pre">/</span></tt>&#8221; as the directory separator; substitute this for the
appropriate character for your system.</p>
<div class="section" id="haskell-source-files">
<span id="source-files"></span><h2>7.8.1. Haskell source files<a class="headerlink" href="separate_compilation.html#haskell-source-files" title="Permalink to this headline">¶</a></h2>
<p id="index-1">Each Haskell source module should be placed in a file on its own.</p>
<p>Usually, the file should be named after the module name, replacing dots
in the module name by directory separators. For example, on a Unix
system, the module <tt class="docutils literal"><span class="pre">A.B.C</span></tt> should be placed in the file <tt class="docutils literal"><span class="pre">A/B/C.hs</span></tt>,
relative to some base directory. If the module is not going to be
imported by another module (<tt class="docutils literal"><span class="pre">Main</span></tt>, for example), then you are free to
use any filename for it.</p>
<p id="index-2">GHC assumes that source files are ASCII or UTF-8 only, other
encoding are not recognised. However, invalid UTF-8 sequences
will be ignored in comments, so it is possible to use other encodings
such as Latin-1, as long as the non-comment source code is ASCII
only.</p>
</div>
<div class="section" id="output-files">
<span id="id1"></span><h2>7.8.2. Output files<a class="headerlink" href="separate_compilation.html#output-files" title="Permalink to this headline">¶</a></h2>
<p id="index-3">When asked to compile a source file, GHC normally generates two files:
an object file, and an interface file.</p>
<p>The object file, which normally ends in a <tt class="docutils literal"><span class="pre">.o</span></tt> suffix, contains the
compiled code for the module.</p>
<p>The interface file, which normally ends in a <tt class="docutils literal"><span class="pre">.hi</span></tt> suffix, contains the
information that GHC needs in order to compile further modules that depend on
this module. It contains things like the types of exported functions,
definitions of data types, and so on. It is stored in a binary format, so don&#8217;t
try to read one; use the <a class="reference internal" href="using.html#ghc-flag---show-iface ⟨file⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">--show-iface</span> <span class="pre">⟨file⟩</span></tt></a> option instead (see
<a class="reference internal" href="separate_compilation.html#hi-options"><em>Other options related to interface files</em></a>).</p>
<p>You should think of the object file and the interface file as a pair,
since the interface file is in a sense a compiler-readable description
of the contents of the object file. If the interface file and object
file get out of sync for any reason, then the compiler may end up making
assumptions about the object file that aren&#8217;t true; trouble will almost
certainly follow. For this reason, we recommend keeping object files and
interface files in the same place (GHC does this by default, but it is
possible to override the defaults as we&#8217;ll explain shortly).</p>
<p>Every module has a <em>module name</em> defined in its source code
(<tt class="docutils literal"><span class="pre">module</span> <span class="pre">A.B.C</span> <span class="pre">where</span> <span class="pre">...</span></tt>).</p>
<p>The name of the object file generated by GHC is derived according to the
following rules, where ⟨osuf⟩ is the object-file suffix (this can be
changed with the <tt class="docutils literal"><span class="pre">-osuf</span></tt> option).</p>
<ul class="simple">
<li>If there is no <tt class="docutils literal"><span class="pre">-odir</span></tt> option (the default), then the object
filename is derived from the source filename (ignoring the module
name) by replacing the suffix with ⟨osuf⟩.</li>
<li>If <tt class="docutils literal"><span class="pre">-odir</span> <span class="pre">⟨dir⟩</span></tt> has been specified, then the object filename is
⟨dir⟩/⟨mod⟩.⟨osuf⟩, where ⟨mod⟩ is the module name with dots replaced
by slashes. GHC will silently create the necessary directory
structure underneath ⟨dir⟩, if it does not already exist.</li>
</ul>
<p>The name of the interface file is derived using the same rules, except that the
suffix is ⟨hisuf⟩ (<tt class="docutils literal"><span class="pre">.hi</span></tt> by default) instead of ⟨osuf⟩, and the relevant
options are <a class="reference internal" href="separate_compilation.html#ghc-flag--hidir ⟨dir⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-hidir</span> <span class="pre">⟨dir⟩</span></tt></a> and <a class="reference internal" href="separate_compilation.html#ghc-flag--hisuf ⟨suffix⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-hisuf</span> <span class="pre">⟨suffix⟩</span></tt></a> instead of
<a class="reference internal" href="separate_compilation.html#ghc-flag--odir ⟨dir⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-odir</span> <span class="pre">⟨dir⟩</span></tt></a> and <a class="reference internal" href="separate_compilation.html#ghc-flag--osuf ⟨suffix⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-osuf</span> <span class="pre">⟨suffix⟩</span></tt></a> respectively.</p>
<p>For example, if GHC compiles the module <tt class="docutils literal"><span class="pre">A.B.C</span></tt> in the file
<tt class="docutils literal"><span class="pre">src/A/B/C.hs</span></tt>, with no <tt class="docutils literal"><span class="pre">-odir</span></tt> or <tt class="docutils literal"><span class="pre">-hidir</span></tt> flags, the interface
file will be put in <tt class="docutils literal"><span class="pre">src/A/B/C.hi</span></tt> and the object file in
<tt class="docutils literal"><span class="pre">src/A/B/C.o</span></tt>.</p>
<p>For any module that is imported, GHC requires that the name of the
module in the import statement exactly matches the name of the module in
the interface file (or source file) found using the strategy specified
in <a class="reference internal" href="separate_compilation.html#search-path"><em>The search path</em></a>. This means that for most modules, the source file
name should match the module name.</p>
<p>However, note that it is reasonable to have a module <tt class="docutils literal"><span class="pre">Main</span></tt> in a file
named <tt class="docutils literal"><span class="pre">foo.hs</span></tt>, but this only works because GHC never needs to search
for the interface for module <tt class="docutils literal"><span class="pre">Main</span></tt> (because it is never imported). It
is therefore possible to have several <tt class="docutils literal"><span class="pre">Main</span></tt> modules in separate
source files in the same directory, and GHC will not get confused.</p>
<p>In batch compilation mode, the name of the object file can also be overridden
using the <a class="reference internal" href="separate_compilation.html#ghc-flag--o ⟨file⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-o</span> <span class="pre">⟨file⟩</span></tt></a> option, and the name of the interface file can
be specified directly using the <a class="reference internal" href="separate_compilation.html#ghc-flag--ohi ⟨file⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-ohi</span> <span class="pre">⟨file⟩</span></tt></a> option.</p>
</div>
<div class="section" id="the-search-path">
<span id="search-path"></span><h2>7.8.3. The search path<a class="headerlink" href="separate_compilation.html#the-search-path" title="Permalink to this headline">¶</a></h2>
<p id="index-4">In your program, you import a module <tt class="docutils literal"><span class="pre">Foo</span></tt> by saying <tt class="docutils literal"><span class="pre">import</span> <span class="pre">Foo</span></tt>.
In <a class="reference internal" href="using.html#ghc-flag---make"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">--make</span></tt></a> mode or GHCi, GHC will look for a source file for <tt class="docutils literal"><span class="pre">Foo</span></tt>
and arrange to compile it first. Without <a class="reference internal" href="using.html#ghc-flag---make"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">--make</span></tt></a>, GHC will look for
the interface file for <tt class="docutils literal"><span class="pre">Foo</span></tt>, which should have been created by an
earlier compilation of <tt class="docutils literal"><span class="pre">Foo</span></tt>. GHC uses the same strategy in each of
these cases for finding the appropriate file.</p>
<p>This strategy is as follows: GHC keeps a list of directories called the
search path. For each of these directories, it tries appending
<tt class="docutils literal"><span class="pre">⟨basename⟩.⟨extension⟩</span></tt> to the directory, and checks whether the
file exists. The value of ⟨basename⟩ is the module name with dots
replaced by the directory separator (&#8220;<tt class="docutils literal"><span class="pre">/</span></tt>&#8221; or &#8220;<tt class="docutils literal"><span class="pre">\\&quot;</span></tt>, depending on the
system), and ⟨extension⟩ is a source extension (<tt class="docutils literal"><span class="pre">hs</span></tt>, <tt class="docutils literal"><span class="pre">lhs</span></tt>) if we
are in <a class="reference internal" href="using.html#ghc-flag---make"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">--make</span></tt></a> mode or GHCi, or ⟨hisuf⟩ otherwise.</p>
<p>For example, suppose the search path contains directories <tt class="docutils literal"><span class="pre">d1</span></tt>,
<tt class="docutils literal"><span class="pre">d2</span></tt>, and <tt class="docutils literal"><span class="pre">d3</span></tt>, and we are in <a class="reference internal" href="using.html#ghc-flag---make"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">--make</span></tt></a> mode looking for the source
file for a module <tt class="docutils literal"><span class="pre">A.B.C</span></tt>. GHC will look in <tt class="docutils literal"><span class="pre">d1/A/B/C.hs</span></tt>,
<tt class="docutils literal"><span class="pre">d1/A/B/C.lhs</span></tt>, <tt class="docutils literal"><span class="pre">d2/A/B/C.hs</span></tt>, and so on.</p>
<p>The search path by default contains a single directory: &#8220;<tt class="docutils literal"><span class="pre">.</span></tt>&#8221; (i.e. the
current directory). The following options can be used to add to or change the
contents of the search path:</p>
<dl class="ghc-flag">
<dt id="ghc-flag--i⟨dir⟩[:⟨dir⟩]*">
<tt class="descname">-i⟨dir⟩</tt><tt class="descclassname">[:⟨dir⟩]*</tt><a class="headerlink" href="separate_compilation.html#ghc-flag--i⟨dir⟩[:⟨dir⟩]*" title="Permalink to this definition">¶</a></dt>
<dd><p id="index-5">This flag appends a colon-separated list of <tt class="docutils literal"><span class="pre">dirs</span></tt> to
the search path.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--i">
<tt class="descname">-i</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--i" title="Permalink to this definition">¶</a></dt>
<dt id="ghc-flag-resets the search path back to nothing.">
<tt class="descname">resets</tt><tt class="descclassname"> the search path back to nothing.</tt><a class="headerlink" href="separate_compilation.html#ghc-flag-resets the search path back to nothing." title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This isn&#8217;t the whole story: GHC also looks for modules in pre-compiled
libraries, known as packages. See the section on packages
(<a class="reference internal" href="packages.html#packages"><em>Packages</em></a>) for details.</p>
</div>
<div class="section" id="redirecting-the-compilation-output-s">
<span id="options-output"></span><h2>7.8.4. Redirecting the compilation output(s)<a class="headerlink" href="separate_compilation.html#redirecting-the-compilation-output-s" title="Permalink to this headline">¶</a></h2>
<span class="target" id="index-6"></span><dl class="ghc-flag">
<dt id="ghc-flag--o ⟨file⟩">
<tt class="descname">-o</tt><tt class="descclassname"> ⟨file⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag--o ⟨file⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>GHC&#8217;s compiled output normally goes into a <tt class="docutils literal"><span class="pre">.hc</span></tt>, <tt class="docutils literal"><span class="pre">.o</span></tt>, etc.,
file, depending on the last-run compilation phase. The option
<tt class="docutils literal"><span class="pre">-o</span> <span class="pre">file</span></tt> re-directs the output of that last-run phase to ⟨file⟩.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This “feature” can be counterintuitive: <tt class="docutils literal"><span class="pre">ghc</span> <span class="pre">-C</span> <span class="pre">-o</span> <span class="pre">foo.o</span> <span class="pre">foo.hs</span></tt>
will put the intermediate C code in the file <tt class="docutils literal"><span class="pre">foo.o</span></tt>, name
notwithstanding!</p>
</div>
<p>This option is most often used when creating an executable file, to
set the filename of the executable. For example:</p>
<div class="highlight-none"><div class="highlight"><pre>ghc -o prog --make Main
</pre></div>
</div>
<p>will compile the program starting with module <tt class="docutils literal"><span class="pre">Main</span></tt> and put the
executable in the file <tt class="docutils literal"><span class="pre">prog</span></tt>.</p>
<p>Note: on Windows, if the result is an executable file, the extension
&#8220;<tt class="docutils literal"><span class="pre">.exe</span></tt>&#8221; is added if the specified filename does not already have
an extension. Thus</p>
<div class="highlight-none"><div class="highlight"><pre>ghc -o foo Main.hs
</pre></div>
</div>
<p>will compile and link the module <tt class="docutils literal"><span class="pre">Main.hs</span></tt>, and put the resulting
executable in <tt class="docutils literal"><span class="pre">foo.exe</span></tt> (not <tt class="docutils literal"><span class="pre">foo</span></tt>).</p>
<p>If you use <tt class="docutils literal"><span class="pre">ghc</span> <span class="pre">--make</span></tt> and you don&#8217;t use the <tt class="docutils literal"><span class="pre">-o</span></tt>, the name GHC
will choose for the executable will be based on the name of the file
containing the module <tt class="docutils literal"><span class="pre">Main</span></tt>. Note that with GHC the <tt class="docutils literal"><span class="pre">Main</span></tt>
module doesn&#8217;t have to be put in file <tt class="docutils literal"><span class="pre">Main.hs</span></tt>. Thus both</p>
<div class="highlight-none"><div class="highlight"><pre>ghc --make Prog
</pre></div>
</div>
<p>and</p>
<div class="highlight-none"><div class="highlight"><pre>ghc --make Prog.hs
</pre></div>
</div>
<p>will produce <tt class="docutils literal"><span class="pre">Prog</span></tt> (or <tt class="docutils literal"><span class="pre">Prog.exe</span></tt> if you are on Windows).</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--odir ⟨dir⟩">
<tt class="descname">-odir</tt><tt class="descclassname"> ⟨dir⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag--odir ⟨dir⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>Redirects object files to directory ⟨dir⟩. For example:</p>
<div class="highlight-none"><div class="highlight"><pre>$ ghc -c parse/Foo.hs parse/Bar.hs gurgle/Bumble.hs -odir `uname -m`
</pre></div>
</div>
<p>The object files, <tt class="docutils literal"><span class="pre">Foo.o</span></tt>, <tt class="docutils literal"><span class="pre">Bar.o</span></tt>, and <tt class="docutils literal"><span class="pre">Bumble.o</span></tt> would be
put into a subdirectory named after the architecture of the
executing machine (<tt class="docutils literal"><span class="pre">x86</span></tt>, <tt class="docutils literal"><span class="pre">mips</span></tt>, etc).</p>
<p>Note that the <tt class="docutils literal"><span class="pre">-odir</span></tt> option does <em>not</em> affect where the interface
files are put; use the <tt class="docutils literal"><span class="pre">-hidir</span></tt> option for that. In the above
example, they would still be put in <tt class="docutils literal"><span class="pre">parse/Foo.hi</span></tt>,
<tt class="docutils literal"><span class="pre">parse/Bar.hi</span></tt>, and <tt class="docutils literal"><span class="pre">gurgle/Bumble.hi</span></tt>.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--ohi ⟨file⟩">
<tt class="descname">-ohi</tt><tt class="descclassname"> ⟨file⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag--ohi ⟨file⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>The interface output may be directed to another file
<tt class="docutils literal"><span class="pre">bar2/Wurble.iface</span></tt> with the option <tt class="docutils literal"><span class="pre">-ohi</span> <span class="pre">bar2/Wurble.iface</span></tt>
(not recommended).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you redirect the interface file somewhere that GHC can&#8217;t
find it, then the recompilation checker may get confused (at the
least, you won&#8217;t get any recompilation avoidance). We recommend
using a combination of <tt class="docutils literal"><span class="pre">-hidir</span></tt> and <tt class="docutils literal"><span class="pre">-hisuf</span></tt> options instead, if
possible.</p>
</div>
<p>To avoid generating an interface at all, you could use this option
to redirect the interface into the bit bucket: <tt class="docutils literal"><span class="pre">-ohi</span> <span class="pre">/dev/null</span></tt>,
for example.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--hidir ⟨dir⟩">
<tt class="descname">-hidir</tt><tt class="descclassname"> ⟨dir⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag--hidir ⟨dir⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>Redirects all generated interface files into ⟨dir⟩, instead of the
default.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--stubdir ⟨dir⟩">
<tt class="descname">-stubdir</tt><tt class="descclassname"> ⟨dir⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag--stubdir ⟨dir⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>Redirects all generated FFI stub files into ⟨dir⟩. Stub files are
generated when the Haskell source contains a <tt class="docutils literal"><span class="pre">foreign</span> <span class="pre">export</span></tt> or
<tt class="docutils literal"><span class="pre">foreign</span> <span class="pre">import</span> <span class="pre">&quot;&amp;wrapper&quot;</span></tt> declaration (see
<a class="reference internal" href="ffi-chap.html#foreign-export-ghc"><em>Using foreign export and foreign import ccall &#8220;wrapper&#8221; with GHC</em></a>). The <tt class="docutils literal"><span class="pre">-stubdir</span></tt> option behaves in
exactly the same way as <tt class="docutils literal"><span class="pre">-odir</span></tt> and <tt class="docutils literal"><span class="pre">-hidir</span></tt> with respect to
hierarchical modules.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--dumpdir ⟨dir⟩">
<tt class="descname">-dumpdir</tt><tt class="descclassname"> ⟨dir⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag--dumpdir ⟨dir⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>Redirects all dump files into ⟨dir⟩. Dump files are generated when
<tt class="docutils literal"><span class="pre">-ddump-to-file</span></tt> is used with other <tt class="docutils literal"><span class="pre">-ddump-*</span></tt> flags.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--outputdir ⟨dir⟩">
<tt class="descname">-outputdir</tt><tt class="descclassname"> ⟨dir⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag--outputdir ⟨dir⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>The <tt class="docutils literal"><span class="pre">-outputdir</span></tt> option is shorthand for the combination of
<a class="reference internal" href="separate_compilation.html#ghc-flag--odir ⟨dir⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-odir</span> <span class="pre">⟨dir⟩</span></tt></a>, <a class="reference internal" href="separate_compilation.html#ghc-flag--hidir ⟨dir⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-hidir</span> <span class="pre">⟨dir⟩</span></tt></a>, <a class="reference internal" href="separate_compilation.html#ghc-flag--stubdir ⟨dir⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-stubdir</span>
<span class="pre">⟨dir⟩</span></tt></a> and <a class="reference internal" href="separate_compilation.html#ghc-flag--dumpdir ⟨dir⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-dumpdir</span> <span class="pre">⟨dir⟩</span></tt></a>.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--osuf ⟨suffix⟩">
<tt class="descname">-osuf</tt><tt class="descclassname"> ⟨suffix⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag--osuf ⟨suffix⟩" title="Permalink to this definition">¶</a></dt>
<dt id="ghc-flag--hisuf ⟨suffix⟩">
<tt class="descname">-hisuf</tt><tt class="descclassname"> ⟨suffix⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag--hisuf ⟨suffix⟩" title="Permalink to this definition">¶</a></dt>
<dt id="ghc-flag--hcsuf ⟨suffix⟩">
<tt class="descname">-hcsuf</tt><tt class="descclassname"> ⟨suffix⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag--hcsuf ⟨suffix⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>The <tt class="docutils literal"><span class="pre">-osuf</span></tt> ⟨suffix⟩ will change the <tt class="docutils literal"><span class="pre">.o</span></tt> file suffix for object
files to whatever you specify. We use this when compiling libraries,
so that objects for the profiling versions of the libraries don&#8217;t
clobber the normal ones.</p>
<p>Similarly, the <tt class="docutils literal"><span class="pre">-hisuf</span></tt> ⟨suffix⟩ will change the <tt class="docutils literal"><span class="pre">.hi</span></tt> file
suffix for non-system interface files (see <a class="reference internal" href="separate_compilation.html#hi-options"><em>Other options related to interface files</em></a>).</p>
<p>Finally, the option <tt class="docutils literal"><span class="pre">-hcsuf</span></tt> ⟨suffix⟩ will change the <tt class="docutils literal"><span class="pre">.hc</span></tt> file
suffix for compiler-generated intermediate C files.</p>
<p>The <tt class="docutils literal"><span class="pre">-hisuf</span></tt>/<tt class="docutils literal"><span class="pre">-osuf</span></tt> game is particularly useful if you want to
compile a program both with and without profiling, in the same
directory. You can say:</p>
<div class="highlight-none"><div class="highlight"><pre>ghc ...
</pre></div>
</div>
<p>to get the ordinary version, and</p>
<div class="highlight-none"><div class="highlight"><pre>ghc ... -osuf prof.o -hisuf prof.hi -prof -fprof-auto
</pre></div>
</div>
<p>to get the profiled version.</p>
</dd></dl>

</div>
<div class="section" id="keeping-intermediate-files">
<span id="keeping-intermediates"></span><h2>7.8.5. Keeping Intermediate Files<a class="headerlink" href="separate_compilation.html#keeping-intermediate-files" title="Permalink to this headline">¶</a></h2>
<p id="index-7">The following options are useful for keeping (or not keeping) certain
intermediate files around, when normally GHC would throw these away after
compilation:</p>
<dl class="ghc-flag">
<dt id="ghc-flag--keep-hc-file">
<tt class="descname">-keep-hc-file</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--keep-hc-file" title="Permalink to this definition">¶</a></dt>
<dt id="ghc-flag--keep-hc-files">
<tt class="descname">-keep-hc-files</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--keep-hc-files" title="Permalink to this definition">¶</a></dt>
<dd><p>Keep intermediate <tt class="docutils literal"><span class="pre">.hc</span></tt> files when doing <tt class="docutils literal"><span class="pre">.hs</span></tt>-to-<tt class="docutils literal"><span class="pre">.o</span></tt>
compilations via <a class="reference internal" href="codegens.html#c-code-gen"><em>C</em></a> (Note: <tt class="docutils literal"><span class="pre">.hc</span></tt> files are only
generated by <a class="reference internal" href="codegens.html#unreg"><em>unregisterised</em></a> compilers).</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--keep-hi-files">
<tt class="descname">-keep-hi-files</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--keep-hi-files" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div></div></blockquote>
<p id="index-8">Keep intermediate <tt class="docutils literal"><span class="pre">.hi</span></tt> files. This is the default. You may use
<tt class="docutils literal"><span class="pre">-no-keep-hi-files</span></tt> if you are not interested in the <tt class="docutils literal"><span class="pre">.hi</span></tt> files.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--keep-llvm-file">
<tt class="descname">-keep-llvm-file</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--keep-llvm-file" title="Permalink to this definition">¶</a></dt>
<dt id="ghc-flag--keep-llvm-files">
<tt class="descname">-keep-llvm-files</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--keep-llvm-files" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Implies:</th><td class="field-body"><a class="reference internal" href="phases.html#ghc-flag--fllvm"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-fllvm</span></tt></a></td>
</tr>
</tbody>
</table>
<p>Keep intermediate <tt class="docutils literal"><span class="pre">.ll</span></tt> files when doing <tt class="docutils literal"><span class="pre">.hs</span></tt>-to-<tt class="docutils literal"><span class="pre">.o</span></tt>
compilations via <a class="reference internal" href="codegens.html#llvm-code-gen"><em>LLVM</em></a> (Note: <tt class="docutils literal"><span class="pre">.ll</span></tt> files
aren&#8217;t generated when using the native code generator, you may need
to use <a class="reference internal" href="phases.html#ghc-flag--fllvm"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-fllvm</span></tt></a> to force them to be produced).</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--keep-o-files">
<tt class="descname">-keep-o-files</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--keep-o-files" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div></div></blockquote>
<p id="index-9">Keep intermediate <tt class="docutils literal"><span class="pre">.o</span></tt> files. This is the default. You may use
<tt class="docutils literal"><span class="pre">-no-keep-o-files</span></tt> if you are not interested in the <tt class="docutils literal"><span class="pre">.o</span></tt> files.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--keep-s-file">
<tt class="descname">-keep-s-file</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--keep-s-file" title="Permalink to this definition">¶</a></dt>
<dt id="ghc-flag--keep-s-files">
<tt class="descname">-keep-s-files</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--keep-s-files" title="Permalink to this definition">¶</a></dt>
<dd><p>Keep intermediate <tt class="docutils literal"><span class="pre">.s</span></tt> files.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--keep-tmp-files">
<tt class="descname">-keep-tmp-files</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--keep-tmp-files" title="Permalink to this definition">¶</a></dt>
<dd><p id="index-10">Instructs the GHC driver not to delete any of its temporary files,
which it normally keeps in <tt class="docutils literal"><span class="pre">/tmp</span></tt> (or possibly elsewhere; see
<a class="reference internal" href="separate_compilation.html#temp-files"><em>Redirecting temporary files</em></a>). Running GHC with <tt class="docutils literal"><span class="pre">-v</span></tt> will show you what
temporary files were generated along the way.</p>
</dd></dl>

</div>
<div class="section" id="redirecting-temporary-files">
<span id="temp-files"></span><h2>7.8.6. Redirecting temporary files<a class="headerlink" href="separate_compilation.html#redirecting-temporary-files" title="Permalink to this headline">¶</a></h2>
<span class="target" id="index-11"></span><dl class="ghc-flag">
<dt id="ghc-flag--tmpdir ⟨dir⟩">
<tt class="descname">-tmpdir</tt><tt class="descclassname"> ⟨dir⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag--tmpdir ⟨dir⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>If you have trouble because of running out of space in <tt class="docutils literal"><span class="pre">/tmp</span></tt> (or
wherever your installation thinks temporary files should go), you
may use the <a class="reference internal" href="separate_compilation.html#ghc-flag--tmpdir ⟨dir⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-tmpdir</span> <span class="pre">⟨dir⟩</span></tt></a> option option to specify an
alternate directory. For example, <tt class="docutils literal"><span class="pre">-tmpdir</span> <span class="pre">.</span></tt> says to put temporary files
in the current working directory.</p>
<p id="index-12">Alternatively, use your <span class="target" id="index-13"></span><tt class="xref std std-envvar docutils literal"><span class="pre">TMPDIR</span></tt> environment variable. Set it to the
name of the directory where temporary files should be put. GCC and other
programs will honour the <span class="target" id="index-14"></span><tt class="xref std std-envvar docutils literal"><span class="pre">TMPDIR</span></tt> variable as well.</p>
</dd></dl>

</div>
<div class="section" id="other-options-related-to-interface-files">
<span id="hi-options"></span><h2>7.8.7. Other options related to interface files<a class="headerlink" href="separate_compilation.html#other-options-related-to-interface-files" title="Permalink to this headline">¶</a></h2>
<span class="target" id="index-15"></span><dl class="ghc-flag">
<dt id="ghc-flag--ddump-hi">
<tt class="descname">-ddump-hi</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--ddump-hi" title="Permalink to this definition">¶</a></dt>
<dd><p>Dumps the new interface to standard output.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--ddump-hi-diffs">
<tt class="descname">-ddump-hi-diffs</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--ddump-hi-diffs" title="Permalink to this definition">¶</a></dt>
<dd><p>The compiler does not overwrite an existing <tt class="docutils literal"><span class="pre">.hi</span></tt> interface file
if the new one is the same as the old one; this is friendly to
<strong class="command">make</strong>. When an interface does change, it is often enlightening to
be informed. The <a class="reference internal" href="separate_compilation.html#ghc-flag--ddump-hi-diffs"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-ddump-hi-diffs</span></tt></a> option will make GHC report the
differences between the old and new <tt class="docutils literal"><span class="pre">.hi</span></tt> files.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--ddump-minimal-imports">
<tt class="descname">-ddump-minimal-imports</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--ddump-minimal-imports" title="Permalink to this definition">¶</a></dt>
<dd><p>Dump to the file <tt class="file docutils literal"><em><span class="pre">M</span></em><span class="pre">.imports</span></tt> (where ⟨M⟩ is the name of the module
being compiled) a &#8220;minimal&#8221; set of import declarations. The
directory where the <tt class="docutils literal"><span class="pre">.imports</span></tt> files are created can be controlled
via the <a class="reference internal" href="separate_compilation.html#ghc-flag--dumpdir ⟨dir⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-dumpdir</span> <span class="pre">⟨dir⟩</span></tt></a> option.</p>
<p>You can safely replace all the import declarations in <tt class="file docutils literal"><em><span class="pre">M</span></em><span class="pre">.hs</span></tt> with
those found in its respective <tt class="docutils literal"><span class="pre">.imports</span></tt> file. Why would you want
to do that? Because the &#8220;minimal&#8221; imports (a) import everything
explicitly, by name, and (b) import nothing that is not required. It
can be quite painful to maintain this property by hand, so this flag
is intended to reduce the labour.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag---show-iface ⟨file⟩">
<tt class="descname">--show-iface</tt><tt class="descclassname"> ⟨file⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag---show-iface ⟨file⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>where ⟨file⟩ is the name of an interface file, dumps the contents of
that interface in a human-readable format. See <a class="reference internal" href="using.html#modes"><em>Modes of operation</em></a>.</p>
</dd></dl>

</div>
<div class="section" id="the-recompilation-checker">
<span id="recomp"></span><h2>7.8.8. The recompilation checker<a class="headerlink" href="separate_compilation.html#the-recompilation-checker" title="Permalink to this headline">¶</a></h2>
<span class="target" id="index-16"></span><dl class="ghc-flag">
<dt id="ghc-flag--fforce-recomp">
<tt class="descname">-fforce-recomp</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--fforce-recomp" title="Permalink to this definition">¶</a></dt>
<dd><p>Turn off recompilation checking (which is on by default).
Recompilation checking normally stops compilation early, leaving an
existing <tt class="docutils literal"><span class="pre">.o</span></tt> file in place, if it can be determined that the
module does not need to be recompiled.</p>
</dd></dl>

<p>In the olden days, GHC compared the newly-generated <tt class="docutils literal"><span class="pre">.hi</span></tt> file with
the previous version; if they were identical, it left the old one alone
and didn&#8217;t change its modification date. In consequence, importers of a
module with an unchanged output <tt class="docutils literal"><span class="pre">.hi</span></tt> file were not recompiled.</p>
<p>This doesn&#8217;t work any more. Suppose module <tt class="docutils literal"><span class="pre">C</span></tt> imports module <tt class="docutils literal"><span class="pre">B</span></tt>,
and <tt class="docutils literal"><span class="pre">B</span></tt> imports module <tt class="docutils literal"><span class="pre">A</span></tt>. So changes to module <tt class="docutils literal"><span class="pre">A</span></tt> might require
module <tt class="docutils literal"><span class="pre">C</span></tt> to be recompiled, and hence when <tt class="docutils literal"><span class="pre">A.hi</span></tt> changes we should
check whether <tt class="docutils literal"><span class="pre">C</span></tt> should be recompiled. However, the dependencies of
<tt class="docutils literal"><span class="pre">C</span></tt> will only list <tt class="docutils literal"><span class="pre">B.hi</span></tt>, not <tt class="docutils literal"><span class="pre">A.hi</span></tt>, and some changes to <tt class="docutils literal"><span class="pre">A</span></tt>
(changing the definition of a function that appears in an inlining of a
function exported by <tt class="docutils literal"><span class="pre">B</span></tt>, say) may conceivably not change <tt class="docutils literal"><span class="pre">B.hi</span></tt> one
jot. So now…</p>
<p>GHC calculates a fingerprint (in fact an MD5 hash) of each interface
file, and of each declaration within the interface file. It also keeps
in every interface file a list of the fingerprints of everything it used
when it last compiled the file. If the source file&#8217;s modification date
is earlier than the <tt class="docutils literal"><span class="pre">.o</span></tt> file&#8217;s date (i.e. the source hasn&#8217;t changed
since the file was last compiled), and the recompilation checking is on,
GHC will be clever. It compares the fingerprints on the things it needs
this time with the fingerprints on the things it needed last time
(gleaned from the interface file of the module being compiled); if they
are all the same it stops compiling early in the process saying
“Compilation IS NOT required”. What a beautiful sight!</p>
<p>You can read about <a class="reference external" href="http://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/RecompilationAvoidance">how all this
works</a>
in the GHC commentary.</p>
</div>
<div class="section" id="how-to-compile-mutually-recursive-modules">
<span id="mutual-recursion"></span><h2>7.8.9. How to compile mutually recursive modules<a class="headerlink" href="separate_compilation.html#how-to-compile-mutually-recursive-modules" title="Permalink to this headline">¶</a></h2>
<p id="index-17">GHC supports the compilation of mutually recursive modules. This section
explains how.</p>
<p>Every cycle in the module import graph must be broken by a <tt class="docutils literal"><span class="pre">hs-boot</span></tt>
file. Suppose that modules <tt class="docutils literal"><span class="pre">A.hs</span></tt> and <tt class="docutils literal"><span class="pre">B.hs</span></tt> are Haskell source
files, thus:</p>
<div class="highlight-haskell"><div class="highlight"><pre>module A where
    import B( TB(..) )

    newtype TA = MkTA Int

    f :: TB -&gt; TA
    f (MkTB x) = MkTA x

module B where
    import {-# SOURCE #-} A( TA(..) )

    data TB = MkTB !Int

    g :: TA -&gt; TB
    g (MkTA x) = MkTB x
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">hs-boot</span></tt> files importing, <tt class="docutils literal"><span class="pre">hi-boot</span></tt> files Here <tt class="docutils literal"><span class="pre">A</span></tt> imports <tt class="docutils literal"><span class="pre">B</span></tt>,
but <tt class="docutils literal"><span class="pre">B</span></tt> imports <tt class="docutils literal"><span class="pre">A</span></tt> with a <tt class="docutils literal"><span class="pre">{-#</span> <span class="pre">SOURCE</span> <span class="pre">#-}</span></tt> pragma, which breaks
the circular dependency. Every loop in the module import graph must be
broken by a <tt class="docutils literal"><span class="pre">{-#</span> <span class="pre">SOURCE</span> <span class="pre">#-}</span></tt> import; or, equivalently, the module
import graph must be acyclic if <tt class="docutils literal"><span class="pre">{-#</span> <span class="pre">SOURCE</span> <span class="pre">#-}</span></tt> imports are ignored.</p>
<p>For every module <tt class="docutils literal"><span class="pre">A.hs</span></tt> that is <tt class="docutils literal"><span class="pre">{-#</span> <span class="pre">SOURCE</span> <span class="pre">#-}</span></tt>-imported in this
way there must exist a source file <tt class="docutils literal"><span class="pre">A.hs-boot</span></tt>. This file contains an
abbreviated version of <tt class="docutils literal"><span class="pre">A.hs</span></tt>, thus:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="kr">module</span> <span class="nn">A</span> <span class="kr">where</span>
    <span class="kr">newtype</span> <span class="kt">TA</span> <span class="ow">=</span> <span class="kt">MkTA</span> <span class="kt">Int</span>
</pre></div>
</div>
<p>To compile these three files, issue the following commands:</p>
<div class="highlight-none"><div class="highlight"><pre>ghc -c A.hs-boot    -- Produces A.hi-boot, A.o-boot
ghc -c B.hs         -- Consumes A.hi-boot, produces B.hi, B.o
ghc -c A.hs         -- Consumes B.hi, produces A.hi, A.o
ghc -o foo A.o B.o  -- Linking the program
</pre></div>
</div>
<p>There are several points to note here:</p>
<ul>
<li><p class="first">The file <tt class="docutils literal"><span class="pre">A.hs-boot</span></tt> is a programmer-written source file. It must
live in the same directory as its parent source file <tt class="docutils literal"><span class="pre">A.hs</span></tt>.
Currently, if you use a literate source file <tt class="docutils literal"><span class="pre">A.lhs</span></tt> you must also
use a literate boot file, <tt class="docutils literal"><span class="pre">A.lhs-boot</span></tt>; and vice versa.</p>
</li>
<li><p class="first">A <tt class="docutils literal"><span class="pre">hs-boot</span></tt> file is compiled by GHC, just like a <tt class="docutils literal"><span class="pre">hs</span></tt> file:</p>
<div class="highlight-none"><div class="highlight"><pre>ghc -c A.hs-boot
</pre></div>
</div>
<p>When a hs-boot file <tt class="docutils literal"><span class="pre">A.hs-boot</span></tt> is compiled, it is checked for
scope and type errors. When its parent module <tt class="docutils literal"><span class="pre">A.hs</span></tt> is compiled,
the two are compared, and an error is reported if the two are
inconsistent.</p>
</li>
<li><p class="first">Just as compiling <tt class="docutils literal"><span class="pre">A.hs</span></tt> produces an interface file <tt class="docutils literal"><span class="pre">A.hi</span></tt>, and
an object file <tt class="docutils literal"><span class="pre">A.o</span></tt>, so compiling <tt class="docutils literal"><span class="pre">A.hs-boot</span></tt> produces an
interface file <tt class="docutils literal"><span class="pre">A.hi-boot</span></tt>, and an pseudo-object file <tt class="docutils literal"><span class="pre">A.o-boot</span></tt>:</p>
<ul class="simple">
<li>The pseudo-object file <tt class="docutils literal"><span class="pre">A.o-boot</span></tt> is empty (don&#8217;t link it!), but
it is very useful when using a Makefile, to record when the
<tt class="docutils literal"><span class="pre">A.hi-boot</span></tt> was last brought up to date (see <a class="reference internal" href="separate_compilation.html#using-make"><em>Using make</em></a>).</li>
<li>The <tt class="docutils literal"><span class="pre">hi-boot</span></tt> generated by compiling a <tt class="docutils literal"><span class="pre">hs-boot</span></tt> file is in
the same machine-generated binary format as any other
GHC-generated interface file (e.g. <tt class="docutils literal"><span class="pre">B.hi</span></tt>). You can display its
contents with <tt class="docutils literal"><span class="pre">ghc</span> <span class="pre">--show-iface</span></tt>. If you specify a directory for
interface files, the <tt class="docutils literal"><span class="pre">-ohidir</span></tt> flag, then that affects <tt class="docutils literal"><span class="pre">hi-boot</span></tt> files
too.</li>
</ul>
</li>
<li><p class="first">If hs-boot files are considered distinct from their parent source
files, and if a <tt class="docutils literal"><span class="pre">{-#</span> <span class="pre">SOURCE</span> <span class="pre">#-}</span></tt> import is considered to refer to
the hs-boot file, then the module import graph must have no cycles.
The command <tt class="docutils literal"><span class="pre">ghc</span> <span class="pre">-M</span></tt> will report an error if a cycle is found.</p>
</li>
<li><p class="first">A module <tt class="docutils literal"><span class="pre">M</span></tt> that is <tt class="docutils literal"><span class="pre">{-#</span> <span class="pre">SOURCE</span> <span class="pre">#-}</span></tt>-imported in a program will
usually also be ordinarily imported elsewhere. If not, <tt class="docutils literal"><span class="pre">ghc</span> <span class="pre">--make</span></tt>
automatically adds <tt class="docutils literal"><span class="pre">M</span></tt> to the set of modules it tries to compile
and link, to ensure that <tt class="docutils literal"><span class="pre">M</span></tt>&#8216;s implementation is included in the
final program.</p>
</li>
</ul>
<p>A hs-boot file need only contain the bare minimum of information needed
to get the bootstrapping process started. For example, it doesn&#8217;t need
to contain declarations for <em>everything</em> that module <tt class="docutils literal"><span class="pre">A</span></tt> exports, only
the things required by the module(s) that import <tt class="docutils literal"><span class="pre">A</span></tt> recursively.</p>
<p>A hs-boot file is written in a subset of Haskell:</p>
<ul>
<li><p class="first">The module header (including the export list), and import statements,
are exactly as in Haskell, and so are the scoping rules. Hence, to
mention a non-Prelude type or class, you must import it.</p>
</li>
<li><p class="first">There must be no value declarations, but there can be type signatures
for values. For example:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="nf">double</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
</pre></div>
</div>
</li>
<li><p class="first">Fixity declarations are exactly as in Haskell.</p>
</li>
<li><p class="first">Vanilla type synonym declarations are exactly as in Haskell.</p>
</li>
<li><p class="first">Open type and data family declarations are exactly as in Haskell.</p>
</li>
<li><p class="first">A closed type family may optionally omit its equations, as in the
following example:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="kr">type</span> <span class="n">family</span> <span class="kt">ClosedFam</span> <span class="n">a</span> <span class="kr">where</span> <span class="o">..</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">..</span></tt> is meant literally &#8211; you should write two dots in your
file. Note that the <tt class="docutils literal"><span class="pre">where</span></tt> clause is still necessary to
distinguish closed families from open ones. If you give any equations
of a closed family, you must give all of them, in the same order as
they appear in the accompanying Haskell file.</p>
</li>
<li><p class="first">A data type declaration can either be given in full, exactly as in
Haskell, or it can be given abstractly, by omitting the &#8216;=&#8217; sign and
everything that follows. For example:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="kr">data</span> <span class="kt">T</span> <span class="n">a</span> <span class="n">b</span>
</pre></div>
</div>
<p>In a <em>source</em> program this would declare TA to have no constructors
(a GHC extension: see <a class="reference internal" href="glasgow_exts.html#nullary-types"><em>Data types with no constructors</em></a>), but in an hi-boot file
it means &#8220;I don&#8217;t know or care what the constructors are&#8221;. This is
the most common form of data type declaration, because it&#8217;s easy to
get right. You <em>can</em> also write out the constructors but, if you do
so, you must write it out precisely as in its real definition.</p>
<p>If you do not write out the constructors, you may need to give a kind
annotation (<a class="reference internal" href="glasgow_exts.html#kinding"><em>Explicitly-kinded quantification</em></a>), to tell GHC the kind of the type
variable, if it is not &#8220;*&#8221;. (In source files, this is worked out
from the way the type variable is used in the constructors.) For
example:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="kr">data</span> <span class="kt">R</span> <span class="p">(</span><span class="n">x</span> <span class="ow">::</span> <span class="o">*</span> <span class="ow">-&gt;</span> <span class="o">*</span><span class="p">)</span> <span class="n">y</span>
</pre></div>
</div>
<p>You cannot use <tt class="docutils literal"><span class="pre">deriving</span></tt> on a data type declaration; write an
<tt class="docutils literal"><span class="pre">instance</span></tt> declaration instead.</p>
</li>
<li><p class="first">Class declarations is exactly as in Haskell, except that you may not
put default method declarations. You can also omit all the
superclasses and class methods entirely; but you must either omit
them all or put them all in.</p>
</li>
<li><p class="first">You can include instance declarations just as in Haskell; but omit
the &#8220;where&#8221; part.</p>
</li>
<li><p class="first">The default role for abstract datatype parameters is now
representational. (An abstract datatype is one with no constructors
listed.) To get another role, use a role annotation. (See
<a class="reference internal" href="glasgow_exts.html#roles"><em>Roles</em></a>.)</p>
</li>
</ul>
</div>
<div class="section" id="module-signatures">
<span id="id2"></span><h2>7.8.10. Module signatures<a class="headerlink" href="separate_compilation.html#module-signatures" title="Permalink to this headline">¶</a></h2>
<p id="index-18">GHC 8.2 supports module signatures (<tt class="docutils literal"><span class="pre">hsig</span></tt> files), which allow you to
write a signature in place of a module implementation, deferring the
choice of implementation until a later point in time.  This feature is
not intended to be used without <a class="reference external" href="http://www.haskell.org/cabal/">Cabal</a>; this manual entry will focus
on the syntax and semantics of signatures.</p>
<p>To start with an example, suppose you had a module <tt class="docutils literal"><span class="pre">A</span></tt> which made use of some
string operations.  Using normal module imports, you would only
be able to pick a particular implementation of strings:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="kr">module</span> <span class="nn">Str</span> <span class="kr">where</span>
    <span class="kr">type</span> <span class="kt">Str</span> <span class="ow">=</span> <span class="kt">String</span>

    <span class="n">empty</span> <span class="ow">::</span> <span class="kt">Str</span>
    <span class="n">empty</span> <span class="ow">=</span> <span class="s">&quot;&quot;</span>

    <span class="n">toString</span> <span class="ow">::</span> <span class="kt">Str</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
    <span class="n">toString</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">s</span>

<span class="kr">module</span> <span class="nn">A</span> <span class="kr">where</span>
    <span class="kr">import</span> <span class="nn">Text</span>
    <span class="n">z</span> <span class="ow">=</span> <span class="n">toString</span> <span class="n">empty</span>
</pre></div>
</div>
<p>By replacing <tt class="docutils literal"><span class="pre">Str.hs</span></tt> with a signature <tt class="docutils literal"><span class="pre">Str.hsig</span></tt>, <tt class="docutils literal"><span class="pre">A</span></tt> (and
any other modules in this package) are now parametrized by
a string implementation:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="nf">signature</span> <span class="kt">Str</span> <span class="kr">where</span>
    <span class="kr">data</span> <span class="kt">Str</span>
    <span class="n">empty</span> <span class="ow">::</span> <span class="kt">Str</span>
    <span class="n">toString</span> <span class="ow">::</span> <span class="kt">Str</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
</pre></div>
</div>
<p>We can typecheck <tt class="docutils literal"><span class="pre">A</span></tt> against this signature, or we can instantiate
<tt class="docutils literal"><span class="pre">Str</span></tt> with a module that provides the following declarations.  Refer
to Cabal&#8217;s documentation for a more in-depth discussion on how to
instantiate signatures.</p>
<p>Module signatures actually consist of two closely related features:</p>
<ul class="simple">
<li>The ability to define an <tt class="docutils literal"><span class="pre">hsig</span></tt> file, containing type definitions
and type signature for values which can be used by modules that
import the signature, and must be provided by the eventual
implementing module, and</li>
<li>The ability to <em>inherit</em> required signatures from packages we
depend upon, combining the signatures into a single merged
signature which reflects the requirements of any locally defined
signature, as well as the requirements of our dependencies.</li>
</ul>
<p>A signature file is denoted by an <tt class="docutils literal"><span class="pre">hsig</span></tt> file; every required
signature must have an <tt class="docutils literal"><span class="pre">hsig</span></tt> file (even if it is an empty one),
including required signatures inherited from dependencies.  Signatures
can be imported using an ordinary <tt class="docutils literal"><span class="pre">import</span> <span class="pre">Sig</span></tt> declaration.</p>
<p><tt class="docutils literal"><span class="pre">hsig</span></tt> files are written in a variant of Haskell similar
to <tt class="docutils literal"><span class="pre">hs-boot</span></tt> files, but with some slight changes:</p>
<ul>
<li><p class="first">The header of a signature is <tt class="docutils literal"><span class="pre">signature</span> <span class="pre">A</span> <span class="pre">where</span> <span class="pre">...</span></tt> (instead
of the usual <tt class="docutils literal"><span class="pre">module</span> <span class="pre">A</span> <span class="pre">where</span> <span class="pre">...</span></tt>).</p>
</li>
<li><p class="first">Import statements and scoping rules are exactly as in Haskell.
To mention a non-Prelude type or class, you must import it.</p>
</li>
<li><p class="first">Unlike regular modules, the defined entities of
a signature include not only those written in the local
<tt class="docutils literal"><span class="pre">hsig</span></tt> file, but also those from inherited signatures
(as inferred from the <a class="reference internal" href="packages.html#ghc-flag--package-id ⟨unit-id⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-package-id</span> <span class="pre">⟨unit-id⟩</span></tt></a> flags).
These entities are not considered in scope when typechecking
the local <tt class="docutils literal"><span class="pre">hsig</span></tt> file, but are available for import by
any module or signature which imports the signature.  The
one exception to this rule is the export list, described
below.</p>
<p>If a declaration occurs in multiple inherited signatures,
they will be <em>merged</em> together.  For values, we require
that the types from both signatures match exactly; however,
other declarations may merge in more interesting ways.
The merging operation in these cases has the effect of
textually replacing all occurrences of the old name with
a reference to the new, merged declaration.  For example,
if we have the following two signatures:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="nf">signature</span> <span class="kt">A</span> <span class="kr">where</span>
    <span class="kr">data</span> <span class="kt">T</span>
    <span class="n">f</span> <span class="ow">::</span> <span class="kt">T</span> <span class="ow">-&gt;</span> <span class="kt">T</span>

<span class="nf">signature</span> <span class="kt">A</span> <span class="kr">where</span>
    <span class="kr">data</span> <span class="kt">T</span> <span class="ow">=</span> <span class="kt">MkT</span>
    <span class="n">g</span> <span class="ow">::</span> <span class="kt">T</span>
</pre></div>
</div>
<p>the resulting merged signature would be:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="nf">signature</span> <span class="kt">A</span> <span class="kr">where</span>
    <span class="kr">data</span> <span class="kt">T</span> <span class="ow">=</span> <span class="kt">MkT</span>
    <span class="n">f</span> <span class="ow">::</span> <span class="kt">T</span> <span class="ow">-&gt;</span> <span class="kt">T</span>
    <span class="n">g</span> <span class="ow">::</span> <span class="kt">T</span>
</pre></div>
</div>
</li>
<li><p class="first">If no export list is provided for a signature, the exports of
a signature are all of its defined entities merged with the
exports of all inherited signatures.</p>
<p>If you want to reexport an entity from a signature, you must
also include a <tt class="docutils literal"><span class="pre">module</span> <span class="pre">SigName</span></tt> export, so that all of the
entities defined in the signature are exported.  For example,
the following module exports both <tt class="docutils literal"><span class="pre">f</span></tt> and <tt class="docutils literal"><span class="pre">Int</span></tt> from
<tt class="docutils literal"><span class="pre">Prelude</span></tt>:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="nf">signature</span> <span class="kt">A</span><span class="p">(</span><span class="kr">module</span> <span class="nn">A</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="kr">where</span>
    <span class="kr">import</span> <span class="nn">Prelude</span> <span class="p">(</span><span class="kt">Int</span><span class="p">)</span>
    <span class="n">f</span> <span class="ow">::</span> <span class="kt">Int</span>
</pre></div>
</div>
<p>Reexports merge with local declarations; thus, the signature above
would successfully merge with:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="nf">signature</span> <span class="kt">A</span> <span class="kr">where</span>
    <span class="kr">data</span> <span class="kt">Int</span>
</pre></div>
</div>
<p>The only permissible implementation of such a signature is a module
which reexports precisely the same entity:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="kr">module</span> <span class="nn">A</span> <span class="p">(</span><span class="nf">f</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="kr">where</span>
    <span class="kr">import</span> <span class="nn">Prelude</span> <span class="p">(</span><span class="kt">Int</span><span class="p">)</span>
    <span class="n">f</span> <span class="ow">=</span> <span class="mi">2</span> <span class="ow">::</span> <span class="kt">Int</span>
</pre></div>
</div>
<p>Conversely, any entity requested by a signature can be provided
by a reexport from the implementing module.  This is different from
<tt class="docutils literal"><span class="pre">hs-boot</span></tt> files, which require every entity to be defined
locally in the implementing module.</p>
</li>
<li><p class="first">GHC has experimental support for <em>signature thinning</em>, which is used
when a signature has an explicit export list without a module export of the
signature itself.  In this case, the export list applies to the final export
list <em>after</em> merging, in particular, you may refer to entities which are not
declared in the body of the local <tt class="docutils literal"><span class="pre">hsig</span></tt> file.</p>
<p>The semantics in this case is that the set of required entities is defined
exclusively by its exports; if an entity is not mentioned in the export list,
it is not required.  The motivation behind this feature is to allow a library
author to provide an omnibus signature containing the type of every function
someone might want to use, while a client thins down the exports to the ones
they actually require.  For example, supposing that you have inherited a
signature for strings, you might write a local signature of this form, listing
only the entities that you need:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="nf">signature</span> <span class="kt">Str</span> <span class="p">(</span><span class="kt">Str</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">append</span><span class="p">,</span> <span class="n">concat</span><span class="p">)</span> <span class="kr">where</span>
    <span class="c1">-- empty</span>
</pre></div>
</div>
<p>A few caveats apply here.  First, it is illegal to export an entity
which refers to a locally defined type which itself is not exported
(GHC will report an error in this case).  Second, signatures which
come from dependencies which expose modules cannot be thinned in this
way (after all, the dependency itself may need the entity); these
requirements are unconditionally exported.  Finally, any module
reexports must refer to modules imported by the local signature
(even if an inherited signature exported the module).</p>
<p>We may change the syntax and semantics of this feature in the future.</p>
</li>
<li><p class="first">The declarations and types from signatures of dependencies
that will be merged in are not in scope when type checking
an <tt class="docutils literal"><span class="pre">hsig</span></tt> file.  To refer to any such type, you must
declare it yourself:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="c1">-- OK, assuming we inherited an A that defines T</span>
<span class="nf">signature</span> <span class="kt">A</span> <span class="p">(</span><span class="kt">T</span><span class="p">)</span> <span class="kr">where</span>
    <span class="c1">-- empty</span>

<span class="c1">-- Not OK</span>
<span class="nf">signature</span> <span class="kt">A</span> <span class="p">(</span><span class="kt">T</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="kr">where</span>
    <span class="n">f</span> <span class="ow">::</span> <span class="kt">T</span> <span class="ow">-&gt;</span> <span class="kt">T</span>

<span class="c1">-- OK</span>
<span class="nf">signature</span> <span class="kt">A</span> <span class="p">(</span><span class="kt">T</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="kr">where</span>
    <span class="kr">data</span> <span class="kt">T</span>
    <span class="n">f</span> <span class="ow">::</span> <span class="kt">T</span> <span class="ow">-&gt;</span> <span class="kt">T</span>
</pre></div>
</div>
</li>
<li><p class="first">There must be no value declarations, but there can be type signatures
for values.  For example, we might define the signature:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="nf">signature</span> <span class="kt">A</span> <span class="kr">where</span>
    <span class="n">double</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
</pre></div>
</div>
<p>A module implementing <tt class="docutils literal"><span class="pre">A</span></tt> would have to export the function
<tt class="docutils literal"><span class="pre">double</span></tt> with a type definitionally equal to the signature.
Note that this means you can&#8217;t implement <tt class="docutils literal"><span class="pre">double</span></tt> using
a polymorphic function <tt class="docutils literal"><span class="pre">double</span> <span class="pre">::</span> <span class="pre">Num</span> <span class="pre">a</span> <span class="pre">=&gt;</span> <span class="pre">a</span> <span class="pre">-&gt;</span> <span class="pre">a</span></tt>.</p>
<p>Note that signature matching does check if <em>fixity</em> matches, so be
sure specify fixity of ordinary identifiers if you intend to use them
with backticks.</p>
</li>
<li><p class="first">Fixity, type synonym, open type/data family declarations
are permitted as in normal Haskell.</p>
</li>
<li><p class="first">Closed type family declarations are permitted as in normal
Haskell.  They can also be given abstractly, as in the
following example:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="kr">type</span> <span class="n">family</span> <span class="kt">ClosedFam</span> <span class="n">a</span> <span class="kr">where</span> <span class="o">..</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">..</span></tt> is meant literally &#8211; you should write two dots in
your file.  The <tt class="docutils literal"><span class="pre">where</span></tt> clause distinguishes closed families
from open ones.</p>
</li>
<li><p class="first">A data type declaration can either be given in full, exactly
as in Haskell, or it can be given abstractly, by omitting the &#8216;=&#8217;
sign and everything that follows.  For example:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="nf">signature</span> <span class="kt">A</span> <span class="kr">where</span>
    <span class="kr">data</span> <span class="kt">T</span> <span class="n">a</span> <span class="n">b</span>
</pre></div>
</div>
<p>Abstract data types can be implemented not only with data
declarations, but also newtypes and type synonyms (with the
restriction that a type synonym must be fully eta-reduced,
e.g., <tt class="docutils literal"><span class="pre">type</span> <span class="pre">T</span> <span class="pre">=</span> <span class="pre">...</span></tt> to be accepted.)  For example,
the following are all valid implementations of the T above:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="c1">-- Algebraic data type</span>
<span class="kr">data</span> <span class="kt">T</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="kt">MkT</span> <span class="n">a</span> <span class="n">b</span>

<span class="c1">-- Newtype</span>
<span class="kr">newtype</span> <span class="kt">T</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="kt">MkT</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="c1">-- Type synonym</span>
<span class="kr">data</span> <span class="kt">T2</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="kt">MkT2</span> <span class="n">a</span> <span class="n">a</span> <span class="n">b</span> <span class="n">b</span>
<span class="kr">type</span> <span class="kt">T</span> <span class="ow">=</span> <span class="kt">T2</span>
</pre></div>
</div>
<p>Data type declarations merge only with other data type
declarations which match exactly, except abstract data,
which can merge with <tt class="docutils literal"><span class="pre">data</span></tt>, <tt class="docutils literal"><span class="pre">newtype</span></tt> or <tt class="docutils literal"><span class="pre">type</span></tt>
declarations.  Merges with type synonyms are especially useful:
suppose you are using a package of strings which has left the type of
characters in the string unspecified:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="nf">signature</span> <span class="kt">Str</span> <span class="kr">where</span>
    <span class="kr">data</span> <span class="kt">Str</span>
    <span class="kr">data</span> <span class="kt">Elem</span>
    <span class="n">head</span> <span class="ow">::</span> <span class="kt">Str</span> <span class="ow">-&gt;</span> <span class="kt">Elem</span>
</pre></div>
</div>
<p>If you locally define a signature which specifies
<tt class="docutils literal"><span class="pre">type</span> <span class="pre">Elem</span> <span class="pre">=</span> <span class="pre">Char</span></tt>, you can now use <tt class="docutils literal"><span class="pre">head</span></tt> from the
inherited signature as if it returned a <tt class="docutils literal"><span class="pre">Char</span></tt>.</p>
<p>If you do not write out the constructors, you may need to give a kind to tell
GHC what the kinds of the type variables are, if they are not the default
<tt class="docutils literal"><span class="pre">*</span></tt>.</p>
<p>Roles of type parameters are subject to the subtyping
relation <tt class="docutils literal"><span class="pre">phantom</span> <span class="pre">&lt;</span> <span class="pre">representational</span> <span class="pre">&lt;</span> <span class="pre">nominal</span></tt>: for example,
an abstract type with a nominal type parameter can be implemented
using a concrete type with a representational type parameter.
Merging respects this subtyping relation (e.g., <tt class="docutils literal"><span class="pre">nominal</span></tt>
merged with <tt class="docutils literal"><span class="pre">representational</span></tt> is <tt class="docutils literal"><span class="pre">representational</span></tt>.)
Roles in signatures default to <tt class="docutils literal"><span class="pre">nominal</span></tt>, which gives maximum
flexibility on the implementor&#8217;s side.  You should only need to
give an explicit role annotation if a client of the signature
would like to coerce the abstract type in a type parameter (in which case you
should specify <tt class="docutils literal"><span class="pre">representational</span></tt> explicitly.)  Unlike
regular data types, we do <em>not</em> assume that abstract
data types are representationally injective: if we have
<tt class="docutils literal"><span class="pre">Coercible</span> <span class="pre">(T</span> <span class="pre">a)</span> <span class="pre">(T</span> <span class="pre">b)</span></tt>, and <tt class="docutils literal"><span class="pre">T</span></tt> has role <tt class="docutils literal"><span class="pre">nominal</span></tt>,
this does not imply that <tt class="docutils literal"><span class="pre">a</span> <span class="pre">~</span> <span class="pre">b</span></tt>.</p>
</li>
<li><p class="first">A class declarations can either be abstract or concrete.  An
abstract class is one with no superclasses or class methods:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="nf">signature</span> <span class="kt">A</span> <span class="kr">where</span>
    <span class="kr">class</span> <span class="kt">Key</span> <span class="n">k</span>
</pre></div>
</div>
<p>It can be implemented in any way, with any set of superclasses
and methods; however, modules depending on an abstract class
are not permitted to define instances (as of GHC 8.2, this
restriction is not checked, see <a class="reference external" href="https://ghc.haskell.org/trac/ghc/ticket/13086">Trac #13086</a>.)
These declarations can be implemented by type synonyms
of kind <tt class="docutils literal"><span class="pre">Constraint</span></tt>; this can be useful if you want to parametrize
over a constraint in functions.  For example, with the
<tt class="docutils literal"><span class="pre">ConstraintKinds</span></tt> extension, this type synonym is a valid
implementation of the signature above:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="kr">module</span> <span class="nn">A</span> <span class="kr">where</span>
    <span class="kr">type</span> <span class="kt">Key</span> <span class="ow">=</span> <span class="kt">Eq</span>
</pre></div>
</div>
<p>A concrete class specifies its superclasses, methods,
default method signatures (but not their implementations)
and a <tt class="docutils literal"><span class="pre">MINIMAL</span></tt> pragma.  Unlike regular Haskell classes,
you don&#8217;t have to explicitly declare a default for a method
to make it optional vis-a-vis the <tt class="docutils literal"><span class="pre">MINIMAL</span></tt> pragma.</p>
<p>When merging class declarations, we require that the superclasses
and methods match exactly; however, <tt class="docutils literal"><span class="pre">MINIMAL</span></tt> pragmas are logically
ORed together, and a method with a default signature will merge
successfully against one that does not.</p>
</li>
<li><p class="first">You can include instance declarations as in Haskell; just omit the
&#8220;where&#8221; part.  An instance declaration need not be implemented directly;
if an instance can be derived based on instances in the environment,
it is considered implemented.  For example, the following signature:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="nf">signature</span> <span class="kt">A</span> <span class="kr">where</span>
    <span class="kr">data</span> <span class="kt">Str</span>
    <span class="kr">instance</span> <span class="kt">Eq</span> <span class="kt">Str</span>
</pre></div>
</div>
<p>is considered implemented by the following module, since there
are instances of <tt class="docutils literal"><span class="pre">Eq</span></tt> for <tt class="docutils literal"><span class="pre">[]</span></tt> and <tt class="docutils literal"><span class="pre">Char</span></tt> which can be combined
to form an instance <tt class="docutils literal"><span class="pre">Eq</span> <span class="pre">[Char]</span></tt>:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="kr">module</span> <span class="nn">A</span> <span class="kr">where</span>
    <span class="kr">type</span> <span class="kt">Str</span> <span class="ow">=</span> <span class="p">[</span><span class="kt">Char</span><span class="p">]</span>
</pre></div>
</div>
<p>Unlike other declarations, for which only the entities declared
in a signature file are brought into scope, instances from the
implementation are always brought into scope, even if they were
not declared in the signature file.  This means that a module may
typecheck against a signature, but not against a matching
implementation.  You can avoid situations like this by never
defining orphan instances inside a package that has signatures.</p>
<p>Instance declarations are only merged if their heads are exactly
the same, so it is possible to get into a situation where GHC
thinks that instances in a signature are overlapping, even if
they are implemented in a non-overlapping way.  If this is
giving you problems give us a shout.</p>
</li>
<li><p class="first">Any orphan instances which are brought into scope by an import
from a signature are unconditionally considered in scope, even
if the eventual implementing module doesn&#8217;t actually import the
same orphans.</p>
</li>
</ul>
<p>Known limitations:</p>
<ul class="simple">
<li>Pattern synonyms are not supported.</li>
<li>Algebraic data types specified in a signature cannot be implemented using
pattern synonyms.  See <a class="reference external" href="https://ghc.haskell.org/trac/ghc/ticket/12717">Trac #12717</a></li>
</ul>
</div>
<div class="section" id="using-make">
<span id="id3"></span><h2>7.8.11. Using <tt class="docutils literal"><span class="pre">make</span></tt><a class="headerlink" href="separate_compilation.html#using-make" title="Permalink to this headline">¶</a></h2>
<p id="index-19">It is reasonably straightforward to set up a <tt class="docutils literal"><span class="pre">Makefile</span></tt> to use with
GHC, assuming you name your source files the same as your modules. Thus:</p>
<div class="highlight-makefile"><div class="highlight"><pre><span class="nv">HC</span>      <span class="o">=</span> ghc
<span class="nv">HC_OPTS</span> <span class="o">=</span> -cpp <span class="k">$(</span>EXTRA_HC_OPTS<span class="k">)</span>

<span class="nv">SRCS</span> <span class="o">=</span> Main.lhs Foo.lhs Bar.lhs
<span class="nv">OBJS</span> <span class="o">=</span> Main.o   Foo.o   Bar.o

<span class="nf">.SUFFIXES </span><span class="o">:</span> .<span class="n">o</span> .<span class="n">hs</span> .<span class="n">hi</span> .<span class="n">lhs</span> .<span class="n">hc</span> .<span class="n">s</span>

<span class="nf">cool_pgm </span><span class="o">:</span> <span class="k">$(</span><span class="nv">OBJS</span><span class="k">)</span>
        rm -f <span class="nv">$@</span>
        <span class="k">$(</span>HC<span class="k">)</span> -o <span class="nv">$@</span> <span class="k">$(</span>HC_OPTS<span class="k">)</span> <span class="k">$(</span>OBJS<span class="k">)</span>

<span class="c"># Standard suffix rules</span>
<span class="nf">.o.hi</span><span class="o">:</span>
        @:

<span class="nf">.lhs.o</span><span class="o">:</span>
        <span class="k">$(</span>HC<span class="k">)</span> -c <span class="nv">$&lt;</span> <span class="k">$(</span>HC_OPTS<span class="k">)</span>

<span class="nf">.hs.o</span><span class="o">:</span>
        <span class="k">$(</span>HC<span class="k">)</span> -c <span class="nv">$&lt;</span> <span class="k">$(</span>HC_OPTS<span class="k">)</span>

<span class="nf">.o-boot.hi-boot</span><span class="o">:</span>
        @:

<span class="nf">.lhs-boot.o-boot</span><span class="o">:</span>
        <span class="k">$(</span>HC<span class="k">)</span> -c <span class="nv">$&lt;</span> <span class="k">$(</span>HC_OPTS<span class="k">)</span>

<span class="nf">.hs-boot.o-boot</span><span class="o">:</span>
        <span class="k">$(</span>HC<span class="k">)</span> -c <span class="nv">$&lt;</span> <span class="k">$(</span>HC_OPTS<span class="k">)</span>

<span class="c"># Inter-module dependencies</span>
<span class="nf">Foo.o Foo.hc Foo.s    </span><span class="o">:</span> <span class="n">Baz</span>.<span class="n">hi</span>          <span class="c"># Foo imports Baz</span>
<span class="nf">Main.o Main.hc Main.s </span><span class="o">:</span> <span class="n">Foo</span>.<span class="n">hi</span> <span class="n">Baz</span>.<span class="n">hi</span>   <span class="c"># Main imports Foo and Baz</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Sophisticated <strong class="command">make</strong> variants may achieve some of the above more
elegantly. Notably, <strong class="command">gmake</strong>&#8216;s pattern rules let you write the more
comprehensible:</p>
<div class="highlight-make"><div class="highlight"><pre><span class="nf">%.o </span><span class="o">:</span> %.<span class="n">lhs</span>
        <span class="k">$(</span>HC<span class="k">)</span> -c <span class="nv">$&lt;</span> <span class="k">$(</span>HC_OPTS<span class="k">)</span>
</pre></div>
</div>
<p class="last">What we&#8217;ve shown should work with any <tt class="docutils literal"><span class="pre">make</span></tt>.</p>
</div>
<p>Note the cheesy <tt class="docutils literal"><span class="pre">.o.hi</span></tt> rule: It records the dependency of the
interface (<tt class="docutils literal"><span class="pre">.hi</span></tt>) file on the source. The rule says a <tt class="docutils literal"><span class="pre">.hi</span></tt> file can
be made from a <tt class="docutils literal"><span class="pre">.o</span></tt> file by doing…nothing. Which is true.</p>
<p>Note that the suffix rules are all repeated twice, once for normal
Haskell source files, and once for <tt class="docutils literal"><span class="pre">hs-boot</span></tt> files (see
<a class="reference internal" href="separate_compilation.html#mutual-recursion"><em>How to compile mutually recursive modules</em></a>).</p>
<p>Note also the inter-module dependencies at the end of the Makefile,
which take the form</p>
<div class="highlight-make"><div class="highlight"><pre><span class="nf">Foo.o Foo.hc Foo.s    </span><span class="o">:</span> <span class="n">Baz</span>.<span class="n">hi</span>          <span class="c"># Foo imports Baz</span>
</pre></div>
</div>
<p>They tell <tt class="docutils literal"><span class="pre">make</span></tt> that if any of <tt class="docutils literal"><span class="pre">Foo.o</span></tt>, <tt class="docutils literal"><span class="pre">Foo.hc</span></tt> or <tt class="docutils literal"><span class="pre">Foo.s</span></tt>
have an earlier modification date than <tt class="docutils literal"><span class="pre">Baz.hi</span></tt>, then the out-of-date
file must be brought up to date. To bring it up to date, <tt class="docutils literal"><span class="pre">make</span></tt> looks
for a rule to do so; one of the preceding suffix rules does the job
nicely. These dependencies can be generated automatically by <tt class="docutils literal"><span class="pre">ghc</span></tt>;
see <a class="reference internal" href="separate_compilation.html#makefile-dependencies"><em>Dependency generation</em></a></p>
</div>
<div class="section" id="dependency-generation">
<span id="makefile-dependencies"></span><h2>7.8.12. Dependency generation<a class="headerlink" href="separate_compilation.html#dependency-generation" title="Permalink to this headline">¶</a></h2>
<p id="index-20">Putting inter-dependencies of the form <tt class="docutils literal"><span class="pre">Foo.o</span> <span class="pre">:</span> <span class="pre">Bar.hi</span></tt> into your
<tt class="docutils literal"><span class="pre">Makefile</span></tt> by hand is rather error-prone. Don&#8217;t worry, GHC has support
for automatically generating the required dependencies. Add the
following to your <tt class="docutils literal"><span class="pre">Makefile</span></tt>:</p>
<div class="highlight-make"><div class="highlight"><pre><span class="nf">depend </span><span class="o">:</span>
        ghc -dep-suffix <span class="s1">&#39;&#39;</span> -M <span class="k">$(</span>HC_OPTS<span class="k">)</span> <span class="k">$(</span>SRCS<span class="k">)</span>
</pre></div>
</div>
<p>Now, before you start compiling, and any time you change the <tt class="docutils literal"><span class="pre">imports</span></tt>
in your program, do <tt class="docutils literal"><span class="pre">make</span> <span class="pre">depend</span></tt> before you do <tt class="docutils literal"><span class="pre">make</span> <span class="pre">cool_pgm</span></tt>. The command
<tt class="docutils literal"><span class="pre">ghc</span> <span class="pre">-M</span></tt> will append the needed dependencies to your <tt class="docutils literal"><span class="pre">Makefile</span></tt>.</p>
<p>In general, <tt class="docutils literal"><span class="pre">ghc</span> <span class="pre">-M</span> <span class="pre">Foo</span></tt> does the following. For each module <tt class="docutils literal"><span class="pre">M</span></tt> in
the set <tt class="docutils literal"><span class="pre">Foo</span></tt> plus all its imports (transitively), it adds to the
Makefile:</p>
<ul>
<li><p class="first">A line recording the dependence of the object file on the source
file.</p>
<div class="highlight-make"><div class="highlight"><pre><span class="nf">M.o </span><span class="o">:</span> <span class="n">M</span>.<span class="n">hs</span>
</pre></div>
</div>
<p>(or <tt class="docutils literal"><span class="pre">M.lhs</span></tt> if that is the filename you used).</p>
</li>
<li><p class="first">For each import declaration <tt class="docutils literal"><span class="pre">import</span> <span class="pre">X</span></tt> in <tt class="docutils literal"><span class="pre">M</span></tt>, a line recording
the dependence of <tt class="docutils literal"><span class="pre">M</span></tt> on <tt class="docutils literal"><span class="pre">X</span></tt>:</p>
<div class="highlight-make"><div class="highlight"><pre><span class="nf">M.o </span><span class="o">:</span> <span class="n">X</span>.<span class="n">hi</span>
</pre></div>
</div>
</li>
<li><p class="first">For each import declaration <tt class="docutils literal"><span class="pre">import</span> <span class="pre">{-#</span> <span class="pre">SOURCE</span> <span class="pre">#-}</span> <span class="pre">X</span></tt> in <tt class="docutils literal"><span class="pre">M</span></tt>, a
line recording the dependence of <tt class="docutils literal"><span class="pre">M</span></tt> on <tt class="docutils literal"><span class="pre">X</span></tt>:</p>
<div class="highlight-make"><div class="highlight"><pre><span class="nf">M.o </span><span class="o">:</span> <span class="n">X</span>.<span class="n">hi</span>-<span class="n">boot</span>
</pre></div>
</div>
<p>(See <a class="reference internal" href="separate_compilation.html#mutual-recursion"><em>How to compile mutually recursive modules</em></a> for details of <tt class="docutils literal"><span class="pre">hi-boot</span></tt> style
interface files.)</p>
</li>
</ul>
<p>If <tt class="docutils literal"><span class="pre">M</span></tt> imports multiple modules, then there will be multiple lines
with <tt class="docutils literal"><span class="pre">M.o</span></tt> as the target.</p>
<p>There is no need to list all of the source files as arguments to the
<tt class="docutils literal"><span class="pre">ghc</span> <span class="pre">-M</span></tt> command; <tt class="docutils literal"><span class="pre">ghc</span></tt> traces the dependencies, just like
<tt class="docutils literal"><span class="pre">ghc</span> <span class="pre">--make</span></tt> (a new feature in GHC 6.4).</p>
<p>Note that <tt class="docutils literal"><span class="pre">ghc</span> <span class="pre">-M</span></tt> needs to find a <em>source file</em> for each module in
the dependency graph, so that it can parse the import declarations and
follow dependencies. Any pre-compiled modules without source files must
therefore belong to a package <a class="footnote-reference" href="separate_compilation.html#id5" id="id4">[1]</a>.</p>
<p>By default, <tt class="docutils literal"><span class="pre">ghc</span> <span class="pre">-M</span></tt> generates all the dependencies, and then
concatenates them onto the end of <tt class="docutils literal"><span class="pre">makefile</span></tt> (or <tt class="docutils literal"><span class="pre">Makefile</span></tt> if
<tt class="docutils literal"><span class="pre">makefile</span></tt> doesn&#8217;t exist) bracketed by the lines
&#8220;<tt class="docutils literal"><span class="pre">#</span> <span class="pre">DO</span> <span class="pre">NOT</span> <span class="pre">DELETE:</span> <span class="pre">Beginning</span> <span class="pre">of</span> <span class="pre">Haskell</span> <span class="pre">dependencies</span></tt>&#8221; and
&#8220;<tt class="docutils literal"><span class="pre">#</span> <span class="pre">DO</span> <span class="pre">NOT</span> <span class="pre">DELETE:</span> <span class="pre">End</span> <span class="pre">of</span> <span class="pre">Haskell</span> <span class="pre">dependencies</span></tt>&#8221;. If these lines
already exist in the <tt class="docutils literal"><span class="pre">makefile</span></tt>, then the old dependencies are deleted
first.</p>
<p>Don&#8217;t forget to use the same <tt class="docutils literal"><span class="pre">-package</span></tt> options on the <tt class="docutils literal"><span class="pre">ghc</span> <span class="pre">-M</span></tt>
command line as you would when compiling; this enables the dependency
generator to locate any imported modules that come from packages. The
package modules won&#8217;t be included in the dependencies generated, though
(but see the <tt class="docutils literal"><span class="pre">-include-pkg-deps</span></tt> option below).</p>
<p>The dependency generation phase of GHC can take some additional options,
which you may find useful. The options which affect dependency
generation are:</p>
<dl class="ghc-flag">
<dt id="ghc-flag--ddump-mod-cycles">
<tt class="descname">-ddump-mod-cycles</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--ddump-mod-cycles" title="Permalink to this definition">¶</a></dt>
<dd><p>Display a list of the cycles in the module graph. This is useful
when trying to eliminate such cycles.</p>
</dd></dl>

<dl class="ghc-flag">
<dt>
<tt class="descname">-v2</tt><tt class="descclassname"></tt></dt>
<dd><p>Print a full list of the module dependencies to stdout. (This is the
standard verbosity flag, so the list will also be displayed with
<tt class="docutils literal"><span class="pre">-v3</span></tt> and <tt class="docutils literal"><span class="pre">-v4</span></tt>; see <a class="reference internal" href="using.html#options-help"><em>Verbosity options</em></a>.)</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--dep-makefile ⟨file⟩">
<tt class="descname">-dep-makefile</tt><tt class="descclassname"> ⟨file⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag--dep-makefile ⟨file⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>Use ⟨file⟩ as the makefile, rather than <tt class="docutils literal"><span class="pre">makefile</span></tt> or
<tt class="docutils literal"><span class="pre">Makefile</span></tt>. If ⟨file⟩ doesn&#8217;t exist, <tt class="docutils literal"><span class="pre">mkdependHS</span></tt> creates it. We
often use <tt class="docutils literal"><span class="pre">-dep-makefile</span> <span class="pre">.depend</span></tt> to put the dependencies in
<tt class="docutils literal"><span class="pre">.depend</span></tt> and then <tt class="docutils literal"><span class="pre">include</span></tt> the file <tt class="docutils literal"><span class="pre">.depend</span></tt> into
<tt class="docutils literal"><span class="pre">Makefile</span></tt>.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--dep-suffix ⟨suffix⟩">
<tt class="descname">-dep-suffix</tt><tt class="descclassname"> ⟨suffix⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag--dep-suffix ⟨suffix⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>Make dependencies that declare that files with suffix
<tt class="docutils literal"><span class="pre">.⟨suf⟩⟨osuf⟩</span></tt> depend on interface files with suffix
<tt class="docutils literal"><span class="pre">.⟨suf⟩hi</span></tt>, or (for <tt class="docutils literal"><span class="pre">{-#</span> <span class="pre">SOURCE</span> <span class="pre">#-}</span></tt> imports) on <tt class="docutils literal"><span class="pre">.hi-boot</span></tt>.
Multiple <tt class="docutils literal"><span class="pre">-dep-suffix</span></tt> flags are permitted. For example,
<tt class="docutils literal"><span class="pre">-dep-suffix</span> <span class="pre">a_</span> <span class="pre">-dep-suffix</span> <span class="pre">b_</span></tt> will make dependencies for <tt class="docutils literal"><span class="pre">.hs</span></tt>
on <tt class="docutils literal"><span class="pre">.hi</span></tt>, <tt class="docutils literal"><span class="pre">.a_hs</span></tt> on <tt class="docutils literal"><span class="pre">.a_hi</span></tt>, and <tt class="docutils literal"><span class="pre">.b_hs</span></tt> on <tt class="docutils literal"><span class="pre">.b_hi</span></tt>.
Note that you must provide at least one suffix; if you do not want a suffix
then pass <tt class="docutils literal"><span class="pre">-dep-suffix</span> <span class="pre">''</span></tt>.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag---exclude-module=⟨file⟩">
<tt class="descname">--exclude-module</tt><tt class="descclassname">=⟨file⟩</tt><a class="headerlink" href="separate_compilation.html#ghc-flag---exclude-module=⟨file⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>Regard <tt class="docutils literal"><span class="pre">⟨file⟩</span></tt> as &#8220;stable&#8221;; i.e., exclude it from having
dependencies on it.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--include-pkg-deps">
<tt class="descname">-include-pkg-deps</tt><tt class="descclassname"></tt><a class="headerlink" href="separate_compilation.html#ghc-flag--include-pkg-deps" title="Permalink to this definition">¶</a></dt>
<dd><p>Regard modules imported from packages as unstable, i.e., generate
dependencies on any imported package modules (including <tt class="docutils literal"><span class="pre">Prelude</span></tt>,
and all other standard Haskell libraries). Dependencies are not
traced recursively into packages; dependencies are only generated
for home-package modules on external-package modules directly
imported by the home package module. This option is normally only
used by the various system libraries.</p>
</dd></dl>

</div>
<div class="section" id="orphan-modules-and-instance-declarations">
<span id="orphan-modules"></span><h2>7.8.13. Orphan modules and instance declarations<a class="headerlink" href="separate_compilation.html#orphan-modules-and-instance-declarations" title="Permalink to this headline">¶</a></h2>
<p>Haskell specifies that when compiling module <tt class="docutils literal"><span class="pre">M</span></tt>, any instance declaration
in any module &#8220;below&#8221; <tt class="docutils literal"><span class="pre">M</span></tt> is visible. (Module <tt class="docutils literal"><span class="pre">A</span></tt> is &#8220;below&#8221; <tt class="docutils literal"><span class="pre">M</span></tt> if <tt class="docutils literal"><span class="pre">A</span></tt> is
imported directly by <tt class="docutils literal"><span class="pre">M</span></tt>, or if <tt class="docutils literal"><span class="pre">A</span></tt> is below a module that <tt class="docutils literal"><span class="pre">M</span></tt> imports
directly.) In principle, GHC must therefore read the interface files of
every module below <tt class="docutils literal"><span class="pre">M</span></tt>, just in case they contain an instance declaration
that matters to <tt class="docutils literal"><span class="pre">M</span></tt>. This would be a disaster in practice, so GHC tries to
be clever.</p>
<p>In particular, if an instance declaration is in the same module as the
definition of any type or class mentioned in the <em>head</em> of the instance
declaration (the part after the &#8220;<tt class="docutils literal"><span class="pre">=&gt;</span></tt>&#8221;; see <a class="reference internal" href="glasgow_exts.html#instance-rules"><em>Relaxed rules for instance contexts</em></a>), then GHC
has to visit that interface file anyway. Example:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="kr">module</span> <span class="nn">A</span> <span class="kr">where</span>
  <span class="kr">instance</span> <span class="kt">C</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="kt">D</span> <span class="p">(</span><span class="kt">T</span> <span class="n">a</span><span class="p">)</span> <span class="kr">where</span> <span class="o">...</span>
  <span class="kr">data</span> <span class="kt">T</span> <span class="n">a</span> <span class="ow">=</span> <span class="o">...</span>
</pre></div>
</div>
<p>The instance declaration is only relevant if the type <tt class="docutils literal"><span class="pre">T</span></tt> is in use, and
if so, GHC will have visited <tt class="docutils literal"><span class="pre">A</span></tt>&#8216;s interface file to find <tt class="docutils literal"><span class="pre">T</span></tt>&#8216;s definition.</p>
<p>The only problem comes when a module contains an instance declaration
and GHC has no other reason for visiting the module. Example:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="kr">module</span> <span class="nn">Orphan</span> <span class="kr">where</span>
  <span class="kr">instance</span> <span class="kt">C</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="kt">D</span> <span class="p">(</span><span class="kt">T</span> <span class="n">a</span><span class="p">)</span> <span class="kr">where</span> <span class="o">...</span>
  <span class="kr">class</span> <span class="kt">C</span> <span class="n">a</span> <span class="kr">where</span> <span class="o">...</span>
</pre></div>
</div>
<p>Here, neither <tt class="docutils literal"><span class="pre">D</span></tt> nor <tt class="docutils literal"><span class="pre">T</span></tt> is declared in module <tt class="docutils literal"><span class="pre">Orphan</span></tt>. We call such modules
&#8220;orphan modules&#8221;. GHC identifies orphan modules, and visits the
interface file of every orphan module below the module being compiled.
This is usually wasted work, but there is no avoiding it. You should
therefore do your best to have as few orphan modules as possible.</p>
<p>Functional dependencies complicate matters. Suppose we have:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="kr">module</span> <span class="nn">B</span> <span class="kr">where</span>
  <span class="kr">instance</span> <span class="kt">E</span> <span class="kt">T</span> <span class="kt">Int</span> <span class="kr">where</span> <span class="o">...</span>
  <span class="kr">data</span> <span class="kt">T</span> <span class="ow">=</span> <span class="o">...</span>
</pre></div>
</div>
<p>Is this an orphan module? Apparently not, because <tt class="docutils literal"><span class="pre">T</span></tt> is declared in
the same module. But suppose class <tt class="docutils literal"><span class="pre">E</span></tt> had a functional dependency:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="kr">module</span> <span class="nn">Lib</span> <span class="kr">where</span>
  <span class="kr">class</span> <span class="kt">E</span> <span class="n">x</span> <span class="n">y</span> <span class="o">|</span> <span class="n">y</span> <span class="ow">-&gt;</span> <span class="n">x</span> <span class="kr">where</span> <span class="o">...</span>
</pre></div>
</div>
<p>Then in some importing module <tt class="docutils literal"><span class="pre">M</span></tt>, the constraint <tt class="docutils literal"><span class="pre">(E</span> <span class="pre">a</span> <span class="pre">Int)</span></tt> should be
&#8220;improved&#8221; by setting <tt class="docutils literal"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">T</span></tt>, <em>even though there is no explicit
mention</em> of <tt class="docutils literal"><span class="pre">T</span></tt> in <tt class="docutils literal"><span class="pre">M</span></tt>.</p>
<p>These considerations lead to the following definition of an orphan
module:</p>
<ul>
<li><p class="first">An <em>orphan module</em> orphan module contains at least one <em>orphan
instance</em> or at least one <em>orphan rule</em>.</p>
</li>
<li><p class="first">An instance declaration in a module <tt class="docutils literal"><span class="pre">M</span></tt> is an <em>orphan instance</em> if
orphan instance</p>
<ul class="simple">
<li>The class of the instance declaration is not declared in <tt class="docutils literal"><span class="pre">M</span></tt>, and</li>
<li><em>Either</em> the class has no functional dependencies, and none of the
type constructors in the instance head is declared in <tt class="docutils literal"><span class="pre">M</span></tt>; <em>or</em>
there is a functional dependency for which none of the type
constructors mentioned in the <em>non-determined</em> part of the
instance head is defined in <tt class="docutils literal"><span class="pre">M</span></tt>.</li>
</ul>
<p>Only the instance head counts. In the example above, it is not good
enough for <tt class="docutils literal"><span class="pre">C</span></tt>&#8216;s declaration to be in module <tt class="docutils literal"><span class="pre">A</span></tt>; it must be the
declaration of <tt class="docutils literal"><span class="pre">D</span></tt> or <tt class="docutils literal"><span class="pre">T</span></tt>.</p>
</li>
<li><p class="first">A rewrite rule in a module <tt class="docutils literal"><span class="pre">M</span></tt> is an <em>orphan rule</em> orphan rule if none
of the variables, type constructors, or classes that are free in the
left hand side of the rule are declared in <tt class="docutils literal"><span class="pre">M</span></tt>.</p>
</li>
</ul>
<p>If you use the flag <a class="reference internal" href="using-warnings.html#ghc-flag--Worphans"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-Worphans</span></tt></a>, GHC will warn you if you are
creating an orphan module. Like any warning, you can switch the warning
off with <a class="reference internal" href="using-warnings.html#ghc-flag--Worphans"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-Wno-orphans</span></tt></a>, and <a class="reference internal" href="using-warnings.html#ghc-flag--Werror"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">-Werror</span></tt></a> will make
the compilation fail if the warning is issued.</p>
<p>You can identify an orphan module by looking in its interface file, <tt class="docutils literal"><span class="pre">M.hi</span></tt>,
using the <a class="reference internal" href="using.html#ghc-flag---show-iface ⟨file⟩"><tt class="xref std std-ghc-flag docutils literal"><span class="pre">--show-iface</span> <span class="pre">⟨file⟩</span></tt></a> <a class="reference internal" href="using.html#modes"><em>mode</em></a>. If there is a
<tt class="docutils literal"><span class="pre">[orphan</span> <span class="pre">module]</span></tt> on the first line, GHC considers it an orphan module.</p>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="separate_compilation.html#id4">[1]</a></td><td>This is a change in behaviour relative to 6.2 and earlier.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="packages.html" title="7.9. Packages"
             >next</a> |</li>
        <li class="right" >
          <a href="runtime_control.html" title="7.7. Running a compiled program"
             >previous</a> |</li>
        <li><a href="index.html">GHC 8.2.2 User&#39;s Guide</a> &raquo;</li>
          <li><a href="usage.html" >7. Using GHC</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, GHC Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>